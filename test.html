<!DOCTYPE html>
<!-- saved from url=(0057)file:///D:/Project/mywebsite/uuwebsite/hashtaghealth.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
    <title>hashtaghealth.html</title>

    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">


    <!--<link rel="stylesheet" type="text/css" href="./styles.css">-->

 	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
	<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>


	<style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            width: 100%;
        }
    </style>
  </head>

  <body>
  	<div id="map" class="leaflet-container leaflet-touch leaflet-retina leaflet-fade-anim" tabindex="0" style="position: relative;"><div class="leaflet-map-pane" style="transform: translate3d(27px, 0px, 0px);"><div class="leaflet-tile-pane"><div class="leaflet-layer"><div class="leaflet-tile-container"></div><div class="leaflet-tile-container leaflet-zoom-animated"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/95.png" style="height: 256px; width: 256px; left: 387px; top: 567px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/96.png" style="height: 256px; width: 256px; left: 387px; top: 823px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/95(1).png" style="height: 256px; width: 256px; left: 131px; top: 567px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/95(2).png" style="height: 256px; width: 256px; left: 643px; top: 567px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/96(1).png" style="height: 256px; width: 256px; left: 131px; top: 823px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/96(2).png" style="height: 256px; width: 256px; left: 643px; top: 823px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/97.png" style="height: 256px; width: 256px; left: 387px; top: 1079px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/94.png" style="height: 256px; width: 256px; left: 387px; top: 311px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/94(1).png" style="height: 256px; width: 256px; left: 643px; top: 311px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/97(1).png" style="height: 256px; width: 256px; left: 643px; top: 1079px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/97(2).png" style="height: 256px; width: 256px; left: 131px; top: 1079px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/94(2).png" style="height: 256px; width: 256px; left: 131px; top: 311px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/96(3).png" style="height: 256px; width: 256px; left: 899px; top: 823px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/95(3).png" style="height: 256px; width: 256px; left: -125px; top: 567px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/96(4).png" style="height: 256px; width: 256px; left: -125px; top: 823px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/95(4).png" style="height: 256px; width: 256px; left: 899px; top: 567px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/97(3).png" style="height: 256px; width: 256px; left: -125px; top: 1079px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/98.png" style="height: 256px; width: 256px; left: 387px; top: 1335px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/94(3).png" style="height: 256px; width: 256px; left: -125px; top: 311px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/94(4).png" style="height: 256px; width: 256px; left: 899px; top: 311px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/97(4).png" style="height: 256px; width: 256px; left: 899px; top: 1079px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/93.png" style="height: 256px; width: 256px; left: 387px; top: 55px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/93(1).png" style="height: 256px; width: 256px; left: 643px; top: 55px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/98(1).png" style="height: 256px; width: 256px; left: 131px; top: 1335px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/98(2).png" style="height: 256px; width: 256px; left: 643px; top: 1335px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/93(2).png" style="height: 256px; width: 256px; left: 131px; top: 55px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/98(3).png" style="height: 256px; width: 256px; left: 899px; top: 1335px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/93(3).png" style="height: 256px; width: 256px; left: 899px; top: 55px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/98(4).png" style="height: 256px; width: 256px; left: -125px; top: 1335px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/93(4).png" style="height: 256px; width: 256px; left: -125px; top: 55px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/99.png" style="height: 256px; width: 256px; left: 387px; top: 1591px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/92.png" style="height: 256px; width: 256px; left: 387px; top: -201px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/92(1).png" style="height: 256px; width: 256px; left: 643px; top: -201px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/99(1).png" style="height: 256px; width: 256px; left: 131px; top: 1591px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/99(2).png" style="height: 256px; width: 256px; left: 643px; top: 1591px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/92(2).png" style="height: 256px; width: 256px; left: 131px; top: -201px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/92(3).png" style="height: 256px; width: 256px; left: -125px; top: -201px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/92(4).png" style="height: 256px; width: 256px; left: 899px; top: -201px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/99(3).png" style="height: 256px; width: 256px; left: -125px; top: 1591px;"><img class="leaflet-tile leaflet-tile-loaded" src="./hashtaghealth_files/99(4).png" style="height: 256px; width: 256px; left: 899px; top: 1591px;"></div></div></div><div class="leaflet-objects-pane"><div class="leaflet-shadow-pane"></div><div class="leaflet-overlay-pane"></div><div class="leaflet-marker-pane"></div><div class="leaflet-popup-pane"><div class="leaflet-popup  leaflet-zoom-animated" style="opacity: 1; transform: translate3d(146px, 258px, 0px); bottom: -7px; left: -163px;"><a class="leaflet-popup-close-button" href="file:///D:/Project/mywebsite/uuwebsite/hashtaghealth.html#close">�</a><div class="leaflet-popup-content-wrapper"><div class="leaflet-popup-content" style="width: 285px;">You clicked the map at LatLng(43.2812, -113.82385)</div></div><div class="leaflet-popup-tip-container"><div class="leaflet-popup-tip"></div></div></div></div></div></div><div class="leaflet-control-container"><div class="leaflet-top leaflet-left"><div class="leaflet-control-zoom leaflet-bar leaflet-control"><a class="leaflet-control-zoom-in" href="file:///D:/Project/mywebsite/uuwebsite/hashtaghealth.html#" title="Zoom in">+</a><a class="leaflet-control-zoom-out" href="file:///D:/Project/mywebsite/uuwebsite/hashtaghealth.html#" title="Zoom out">-</a></div></div><div class="leaflet-top leaflet-right"><div class="leaflet-control-layers leaflet-control" aria-haspopup="true"><a class="leaflet-control-layers-toggle" href="file:///D:/Project/mywebsite/uuwebsite/hashtaghealth.html#" title="Layers"></a><form class="leaflet-control-layers-list"><div class="leaflet-control-layers-base"><label><input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers"><span> Restaurants</span></label><label><input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers"><span> Parks</span></label><label><input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers"><span> OSM parks</span></label><label><input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers"><span> OSM Restaurants</span></label></div><div class="leaflet-control-layers-separator" style="display: none;"></div><div class="leaflet-control-layers-overlays"></div></form></div></div><div class="leaflet-bottom leaflet-left"></div><div class="leaflet-bottom leaflet-right"><div class="leaflet-control-attribution leaflet-control"><a href="http://leafletjs.com/" title="A JS library for interactive maps">Leaflet</a> | Map data ? <a href="http://openstreetmap.org/">OpenStreetMap</a> contributors</div></div></div></div>
<!--    // <div id="map" style="width: 600px; height: 400px"></div> -->
	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

	<script>
// 		set Salt Lake City at the center 40.78054, -111.9342

		var map = L.map('map').setView([40.78054, -111.9342], 8);
// 		var map = L.map('map', { //.setView([40.78054, -111.9342], 8);
// 			center: [40.78054, -111.9342],
// 			zoom: 8,
// 			layers: [grayscale, cities]
// 		});
		var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
		var osmAttrib='Map data ? <a href="http://openstreetmap.org">OpenStreetMap</a> contributors';
		var osm = new L.TileLayer(osmUrl, {minZoom: 2, maxZoom: 14, attribution: osmAttrib});
		map.addLayer(osm);


/* 		L.marker([51.5, -0.09]).addTo(map)
			.bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();

		L.circle([51.508, -0.11], 500, {
			color: 'red',
			fillColor: '#f03',
			fillOpacity: 0.5
		}).addTo(map).bindPopup("I am a circle.");

		L.polygon([
			[51.509, -0.08],
			[51.503, -0.06],
			[51.51, -0.047]
		]).addTo(map).bindPopup("I am a polygon."); */

	    var rootURL = 'http://dapeng.chpc.utah.edu:8081'

		var popup = L.popup();
	    var intLayers = [];
	    var intLayersString = "";

	  	function handleJson(data) {
	        selectedFeature = L.geoJson(data, {
	            style: function (feature) {
	                return {color: 'yellow'};
	            },
	            onEachFeature: function (feature, layer) {
	                var content = "";
	                content = content + "<b><u>" + feature.id.split('.')[0] + "</b></u><br>";
	                delete feature.properties.bbox;
	                for (var name in feature.properties) {content = content + "<b>" + name + ":</b> " + feature.properties[name] + "<br>"};
	                var popup = L.popup()
	                    .setLatLng(queryCoordinates)
	                    .setContent(content)
	                    .openOn(map);
	                layer.bindPopup(content);
	                layer.on({
	                    mouseover: highlightFeature,
	                    mouseout: resetHighlight
	                });
	            },
	            pointToLayer: function (feature, latlng) {
	                return L.circleMarker(latlng, {
	                    radius: 5,
	                    fillColor: "yellow",
	                    color: "#000",
	                    weight: 5,
	                    opacity: 0.6,
	                    fillOpacity: 0.2
	                });
	            }
	        });
	        selectedFeature.addTo(map);
	    }
		function onMapClick(e) {
			var owsrootUrl = rootURL + '/geoserver/cite/wms';
			popup
			.setLatLng(e.latlng)
			.setContent("You clicked the map at " + e.latlng.toString())
			.openOn(map);

	        params = {
	                request: 'GetFeatureInfo',
	                service: 'WMS',
	                srs: 'EPSG:4326',
	                styles: this.wmsParams.styles,
	                transparent: this.wmsParams.transparent,
	                version: this.wmsParams.version,
	                format: this.wmsParams.format,
	                bbox: map.getBounds().toBBoxString(),
	                height: size.y,
	                width: size.x,
	                layers: this.wmsParams.layers,
	                query_layers: this.wmsParams.layers,
	                info_format: 'text/html'
	              };
	        var customParams = {
	            //bbox : map.getBounds().toBBoxString(),
	            cql_filter:'DWithin(geom, POINT(' + e.latlng.lng + ' ' + e.latlng.lat + '), 10, meters)'
	        };

	        var url = owsrootUrl + L.Util.getParamString(parameters)

	        //console.log(url);
	        var parameters = L.Util.extend(defaultParameters, customParams);


	        $.ajax({
	            url : owsrootUrl + L.Util.getParamString(parameters),
	            dataType : 'jsonp',
	            jsonpCallback : 'getJson',
	            success : handleJson
	        });

		}
		function Identify(e)
		{
			var owsrootUrl = rootURL + '/geoserver/cite/wms';
		    // set parameters needed for GetFeatureInfo WMS request
		    var BBOX = map.getBounds().toBBoxString();
		    var WIDTH = map.getSize().x;
		    var HEIGHT = map.getSize().y;
		    var X = map.layerPointToContainerPoint(e.layerPoint).x;
		    var Y = map.layerPointToContainerPoint(e.layerPoint).y;
		     // compose the URL for the request
		    var URL = owsrootUrl + '?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetFeatureInfo&LAYERS=cite:urbanarea&QUERY_LAYERS=cite:urbanarea&BBOX='+BBOX+'&FEATURE_COUNT=1&HEIGHT='+HEIGHT+'&WIDTH='+WIDTH+'&INFO_FORMAT=application/json&SRS=EPSG%3A4326&X='+X+'&Y='+Y;

// 		    map.removelayer(geojsonLayer);
// 			popup
// 			.setLatLng(e.latlng)
// 			.setContent("You clicked the map at " + URL)
// 			.openOn(map);
		    //send the asynchronous HTTP request using jQuery $.ajax
		    $.ajax({
		        url: URL,
		        dataType: "json",
		        type: "GET",
		        success: function(data)
		        {

		            var popup = new L.Popup
		            ({
		                maxWidth: 300
		            });
		            geojsonLayer = L.geoJson(data);
		            geojsonLayer.addTo(map);
// 		            var feature = $.parseJSON(data)

					var jsondata = data;
					var feature = jsondata[0];
		            popup.setContent(data.features[0].properties.NAME10);
		            popup.setLatLng(e.latlng);
		            map.openPopup(popup);

		        }
		    });

		}

		map.on('click', Identify);
// 		http://localhost:8081/geoserver/cite/wms?service=WMS&version=1.1.0&request=GetMap&layers=cite:parkslocal&styles=&bbox=-113.24020018621867,37.58503743142043,-109.75044605371143,41.98452371877478&width=406&height=512&srs=EPSG:4326&format=application/openlayers
		//var restaurants = L.tileLayer.wms("http://dapeng.chpc.utah.edu:8081/geoserver/cite/wms", {
		var restaurants = L.tileLayer.wms(rootURL + "geoserver/cite/wms", {
	    layers: 'cite:restaurant',
	    format: 'image/png',
	    transparent: true,
	    attribution: "Weather data � 2012 IEM Nexrad"
	    });
	    //var parks = L.tileLayer.wms("http://dapeng.chpc.utah.edu:8081/geoserver/cite/wms", {
		var parks = L.tileLayer.wms(rootURL + "/geoserver/cite/wms", {
	    layers: 'cite:parkslocal',
	    format: 'image/png',
	    transparent: true,
	    attribution: "Weather data � 2012 IEM Nexrad"
	    });
	    //var osmparks = L.tileLayer.wms("http://dapeng.chpc.utah.edu:8081/geoserver/cite/wms", {
		var osmparks = L.tileLayer.wms(rootURL + "/geoserver/cite/wms", {
	    layers: 'cite:osmparks',
	    format: 'image/png',
	    transparent: true,
	    attribution: "Weather data � 2012 IEM Nexrad"
	    });

		var osmusrest = L.tileLayer.wms(rootURL + "/geoserver/cite/wms", {
	    layers: 'cite:usosmrest',
	    format: 'image/png',
	    transparent: true,
	    attribution: "Weather data ? 2012 IEM Nexrad"
	    });
		var urbanarea = L.tileLayer.wms(rootURL + "/geoserver/cite/wms", {
		    layers: 'cite:urbanarea',
		    format: 'image/png',
		    transparent: true,
		    attribution: "Weather data ? 2012 IEM Nexrad"
		    });

		var utahcities = L.tileLayer.wms(rootURL + "/geoserver/cite/wms", {
		    layers: 'cite:utahcities',
		    format: 'image/png',
		    transparent: true,
		    attribution: "Weather data ? 2012 IEM Nexrad"
		    });

		var yelpdata = L.tileLayer.wms(rootURL + "/geoserver/cite/wms", {
		    layers: 'cite:yelpdata',
		    format: 'image/png',
		    transparent: true,
		    attribution: "Weather data ? 2012 IEM Nexrad"
		    });
		var osmus8 = L.tileLayer.wms(rootURL + "/geoserver/cite/wms", {
		    layers: 'cite:osmus8',
		    format: 'image/png',
		    transparent: true,
		    attribution: "Weather data ? 2012 IEM Nexrad"
		    });
    var tracts = L.tileLayer.wms(rootURL + "/geoserver/cite/wms", {
        layers: 'cite:2010tracts',
        format: 'image/png',
        transparent: true,
        attribution: "Weather data ? 2012 IEM Nexrad"
        });
		var overlays = {
			"Restaurants": restaurants,
			"Parks": parks,
			"OSM parks": osmparks,
			"OSM Restaurants":osmusrest,
			"Urban areas": urbanarea,
			"OSM Utah cities":utahcities,
			"Yelp data":yelpdata,
			"OSM administrative level 8":osmus8,
      "census tracts (2010 Census)":tracts
		};
		L.control.layers(overlays).addTo(map);
// 		L.control.fullscreen().addTo(map);
	</script>

</body>
</html>
